#!/usr/bin/env bash

BUILD_DIR=$1
CACHE_DIR=$2

NODE_VERSION=v8.9.0
NODE_DIST=node-$NODE_VERSION-linux-x64
NODE_TAR=$NODE_DIST.tar.xz
NODE_URL="https://nodejs.org/dist/$NODE_VERSION/$NODE_TAR"
NODE_TAR_PATH=$CACHE_DIR/$NODE_TAR

mkdir -p $CACHE_DIR

echo "Downloading node $NODE_VERSION..."
heroku run curl -sL $NODE_URL -o $NODE_TAR_PATH

if [ -f $NODE_TAR_PATH ]; then
  echo "Download complete, extracting downloaded content..."
  heroku run tar xf $NODE_TAR_PATH

  echo "Installing node $NODE_VERSION"
  heroku run mkdir -p $BUILD_DIR/bin
  heroku run mv $NODE_DIST $BUILD_DIR/bin

  heroku run $BUILD_DIR/bin/$NODE_DIST/node -v

  exit 0
fi

exit 3003